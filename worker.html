<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worker Dashboard</title>
   

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to bottom right, #2C3D73, #1B1B1B);

            min-height: 100vh;
            color: #333;
            padding-bottom: 40px;
        }

        header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            animation: slideDown 0.5s ease-out;
        }

        .langandrole {
  display: flex;
  flex-direction: row;
  gap: 10px; 
  align-items: center; 
            justify-content:center;
}


         .sos-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
           
             width:50px;
        }

        .sos-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
         
        }

        .sos-btn:active {
            transform: translateY(0);
        }

        .alert-message {
            display: none;
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            font-weight: 600;
        }

        .alert-message.show {
            display: block;
        }
        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        header h1 {
            font-size: 26px;
            color: #667eea;
            font-weight: 700;
        }

        header h1 span {
            color: #2C3D73;
            font-weight: 800;
        }

        .logoutBtn {
        background-color: #DC143C;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
         
        }

        .logoutBtn:hover {
            transform: translateY(-2px);
            
        }

        main {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
        }

        section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.6s ease-out;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        section:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        section h2 {
            color:  #2C3D73;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 3px solid #764ba2;
        }

        #settings {
            grid-column: span 2;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: end;
        }

        label {
            color: #2c3e50;
            font-size: 14px;
            font-weight: 600;
            display: block;
            margin-bottom: 8px;
        }

        select, input[type="text"], input[type="file"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 15px;
            color: #2c3e50;
            background: #f8f9fa;
            transition: all 0.3s ease;
            outline: none;
        }

        select:focus, input[type="text"]:focus {
            border-color: #667eea;
            background: #fff;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        input[type="file"] {
            padding: 10px;
            cursor: pointer;
        }

        button {
            background-color: #DC143C;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
           
            width: 100%;
            margin-top: 12px;
        }

        button:hover {
            transform: translateY(-2px);
           
        }

        button:active {
            transform: translateY(0);
        }

        #geofence button, #checklist button:first-of-type, #hazard-report button:first-of-type {
            background:  #667eea;
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3);
        }

        #geofence button:hover, #checklist button:first-of-type:hover, #hazard-report button:first-of-type:hover {
            box-shadow: 0 6px 20px rgba(240, 147, 251, 0.4);
        }

        #zoneAlert {
            margin-top: 16px;
            padding: 14px;
            border-radius: 10px;
            font-weight: 600;
            text-align: center;
            display: none;
        }

        #zoneAlert.safe {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
            display: block;
        }

        #zoneAlert.danger {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
            display: block;
        }

        ul {
            list-style: none;
            margin: 16px 0;
        }

        ul li {
            padding: 14px 16px;
            margin-bottom: 12px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        ul li:hover {
            background: #e8f0fe;
            transform: translateX(4px);
        }

        ul li input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #667eea;
        }

        ol {
            list-style-position: inside;
            color: #34495e;
        }

        ol li {
            padding: 12px 16px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #27ae60;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        ol li:hover {
            background: #e8f4f8;
            transform: translateX(4px);
        }

        ol li:nth-child(1) {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border-left-color: #f39c12;
        }

        ol li:nth-child(2) {
            background: linear-gradient(135deg, #c0c0c0 0%, #d9d9d9 100%);
            border-left-color: #95a5a6;
        }

        ol li:nth-child(3) {
            background: linear-gradient(135deg, #cd7f32 0%, #d89a5a 100%);
            border-left-color: #d35400;
        }

       video {
            width: 100%;
            max-width: 100%;
            border-radius: 12px;
            margin-bottom: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            border-radius: 12px;
            margin-bottom: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 12px;
        }

        #video-of-the-day {
            grid-column: span 2;
        }


        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 14px;
            border-radius: 10px;
            margin-top: 12px;
            border: 2px solid #c3e6cb;
            font-weight: 600;
            text-align: center;
            display: none;
        }

        .success-message.show {
            display: block;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* UPDATE START: layout polish (desktop) */
        header .logoutBtn { width:auto; padding:10px 16px; font-size:14px; }
        #geofence button, #cameraCheck button { width:auto; padding:10px 16px; }
        #settings { grid-template-columns: repeat(auto-fit, minmax(220px, max-content)); justify-content: start; align-items:center; }
        #settings select { width:auto; max-width:240px; padding:8px 12px; font-size:14px; }
        /* UPDATE END */

        /* Mobile optimizations */
        @media (max-width: 768px) {
            header {
                padding: 16px 20px;
                flex-direction: row;
                gap: 12px;
                text-align: center;
            }

            header h1 {
                font-size: 20px;
            }

            .logoutBtn {
                width: 100%;
            }

            main {
                margin: 20px auto;
                padding: 0 16px;
                grid-template-columns: 1fr;
                gap: 20px;
            }

            #settings, #video-of-the-day {
                grid-column: span 1;
            }

            section {
                padding: 20px;
            }

            section h2 {
                font-size: 18px;
            }

            button {
                font-size: 14px;
                padding: 11px 20px;
            }
        }

        @media (max-width: 480px) {
            header h1 {
                font-size: 18px;
            }

            section {
                padding: 16px;
            }

            section h2 {
                font-size: 16px;
                margin-bottom: 16px;
            }
        }
    </style>
    <!-- 👇 AI libraries for camera PPE detection -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

</head>
<body>
    <header>
        <h1> Welcome, <span id="workerName">Worker</span>!</h1>
        <button class="logoutBtn" onclick="logout()">Logout</button>
    </header>
  <!-- Settings -->
    <center>
    <div class="langandrole">
       
            <div>
                <label for="language" style="color:white"> Choose Language:</label>
                <select id="language" onchange="updateChecklistLanguage()">
                     <option value="en">English</option>
        <option value="hi">हिंदी (Hindi)</option>
        <option value="te">తెలుగు (Telugu)</option>
        <option value="kn">ಕನ್ನಡ (Kannada)</option>
        <option value="ta">தமிழ் (Tamil)</option>
        <option value="ml">മലയാളം (Malayalam)</option>
        <option value="mr">मराठी (Marathi)</option>
        <option value="bn">বাংলা (Bengali)</option>
        <option value="gu">ગુજરાતી (Gujarati)</option>
        <option value="or">ଓଡ଼ିଆ (Odia)</option>
                </select>
            </div>
                  <div>
                <label for="roleType" style="color:white"> Select Role:</label>
                <select id="roleType" onchange="updateChecklistRole()">
                    <option value="drill">Drill Operator</option>
                    <option value="blaster">Blaster</option>
                    <option value="general">General Worker</option>
                </select>
            </div>
      

        </div>
<button class="sos-btn" onclick="sendSOS()">SOS</button>
    <div id="alertMsg" class="alert-message"></div>
        </center>
    
    <main>
      
            
      

        <!-- Geofence (single, de-duplicated) -->
        <section id="geofence">
            <h2> Mine Zone Safety Check</h2>
            <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px">
                <button type="button" onclick="window.startLiveTracking()">Start Live Tracking</button>
                <button type="button" onclick="window.stopLiveTracking()">Stop Tracking</button>
                <button type="button" onclick="window.repaintZones()">Refresh Zone Risk</button>
            </div>
            <p id="zoneAlert">Location tracking not started.</p>
            <div id="zoneMap" style="height:320px; border-radius:10px; overflow:hidden; border:1px solid #e5e5e5"></div>
        </section>

        <!-- Daily Checklist -->
        <section id="checklist">
            <h2>Daily Safety Checklist</h2>
            <button onclick="readChecklist()">Listen to Checklist</button>
            <ul id="checklistItems">
                <!-- Checklist items generated dynamically -->
            </ul>
            <button onclick="submitChecklist()">Submit Checklist</button>
            <div id="checklistSuccess" class="success-message">✓ Checklist submitted successfully!</div>
        </section>
        <!-- 📸 Camera PPE Auto Check -->
<section id="cameraCheck">
  <h2>Camera PPE Auto Check</h2>
  <video id="camera" autoplay playsinline muted width="320" height="240" style="background:#000;border-radius:8px"></video>
  <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
    <button type="button" onclick="startCamera()">Start Camera</button>
    <button type="button" onclick="stopCamera()">Stop Camera</button>
  </div>
  <p id="cameraStatus">Camera not started</p>
</section>


<!-- Video of the Day -->
        <section id="video-of-the-day">
            <h2>🎥 Safety Video of the Day</h2>
            <div class="video-wrapper">
                <iframe
                    id="safetyYT"
                    src="https://www.youtube.com/embed/osNwXd37Vz4"
                    title="Mine safety training"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen
                    referrerpolicy="strict-origin-when-cross-origin">
                </iframe>
            </div>
            <button onclick="markVideoWatched()">Mark as Watched</button>
            <div id="videoSuccess" class="success-message">✓ Video marked as watched! +10 points earned</div>
        </section>



        <!-- Hazard Reporting -->
        <section id="hazard-report">
            <h2>Report a Hazard</h2>
            <button onclick="readHazardInstructions()">Listen Instructions</button>
            <input type="text" id="hazardDesc" placeholder="Describe the hazard in detail...">
            <input type="file" id="hazardFile" accept="image/*,video/*">
            <button onclick="submitHazard()">Submit Report</button>
            <div id="hazardSuccess" class="success-message">✓ Hazard reported successfully! +15 points earned</div>
        </section>
        <!-- 📸 Camera PPE Auto Check -->



        <!-- Leaderboard -->
        <section id="leaderboard">
            <h2>Leaderboard</h2>
            <ol id="leaderboardList">
                <li>Worker A - 50 points</li>
                <li>Worker B - 40 points</li>
                <li>Worker C - 30 points</li>
            </ol>
        </section>
    </main>

    <script>
        // Check if user is logged in
        const username = sessionStorage.getItem('username');
        const role = sessionStorage.getItem('role');
        
        if (!username || role !== 'worker') {
            window.location.href = 'index.html';
        }
        
        // Store data
        let userData = { username: username, role: role };
        let currentLanguage = 'en';
        let currentRole = 'drill';
        let userPoints = 25;

        // Load username
        document.getElementById('workerName').innerText = userData.username;

        // Checklist data by role and language
        const checklistData = {
    en: {
        drill: [
            'Check drill bit condition',
            'Inspect hydraulic lines',
            'Verify emergency stop function',
            'Check water supply for dust suppression',
            'Inspect personal protective equipment'
        ],
        blaster: [
            'Verify explosive storage security',
            'Check detonator functionality',
            'Inspect blast area clearance',
            'Confirm communication devices',
            'Review blast plan and timing'
        ],
        general: [
            'Inspect helmet and safety boots',
            'Check work area for hazards',
            'Verify emergency exit routes',
            'Inspect tools and equipment',
            'Review daily safety briefing'
        ]
    },
    hi: {
        drill: [
            'ड्रिल बिट की स्थिति जांचें',
            'हाइड्रोलिक लाइनों का निरीक्षण करें',
            'आपातकालीन स्टॉप फ़ंक्शन सत्यापित करें',
            'धूल दमन के लिए पानी की आपूर्ति जांचें',
            'व्यक्तिगत सुरक्षा उपकरण की जांच करें'
        ],
        blaster: [
            'विस्फोटक भंडारण सुरक्षा सत्यापित करें',
            'डेटोनेटर कार्यक्षमता जांचें',
            'विस्फोट क्षेत्र निकासी का निरीक्षण करें',
            'संचार उपकरण की पुष्टि करें',
            'विस्फोट योजना और समय की समीक्षा करें'
        ],
        general: [
            'हेलमेट और सुरक्षा जूते का निरीक्षण करें',
            'कार्य क्षेत्र में खतरों की जांच करें',
            'आपातकालीन निकास मार्ग सत्यापित करें',
            'उपकरण और साजो-सामान का निरीक्षण करें',
            'दैनिक सुरक्षा ब्रीफिंग की समीक्षा करें'
        ]
    },
    te: {
        drill: [
            'డ్రిల్ బిట్ స్థితిను తనిఖీ చేయండి',
            'హైడ్రాలిక్ లైన్లను తనిఖీ చేయండి',
            'ఎమర్జెన్సీ స్టాప్ ఫంక్షన్‌ను ధృవీకరించండి',
            'దుమ్ము అణచివేత కోసం నీటి సరఫరాను తనిఖీ చేయండి',
            'వ్యక్తిగత రక్షణ పరికరాలను తనిఖీ చేయండి'
        ],
        blaster: [
            'పేలుడు నిల్వ భద్రతను ధృవీకరించండి',
            'డిటోనేటర్ కార్యాచరణను తనిఖీ చేయండి',
            'పేలుడు ప్రాంత క్లియరెన్స్‌ను తనిఖీ చేయండి',
            'కమ్యూనికేషన్ పరికరాలను నిర్ధారించండి',
            'పేలుడు ప్రణాళిక మరియు సమయాన్ని సమీక్షించండి'
        ],
        general: [
            'హెల్మెట్ మరియు భద్రతా బూట్లను తనిఖీ చేయండి',
            'పని ప్రాంతంలో ప్రమాదాల కోసం తనిఖీ చేయండి',
            'అత్యవసర నిష్క్రమణ మార్గాలను ధృవీకరించండి',
            'సాధనాలు మరియు పరికరాలను తనిఖీ చేయండి',
            'రోజువారీ భద్రతా బ్రీఫింగ్‌ను సమీక్షించండి'
        ]
    },
    kn: {
        drill: [
            'ಡ್ರಿಲ್ ಬಿಟ್ ಸ್ಥಿತಿಯನ್ನು ಪರಿಶೀಲಿಸಿ',
            'ಹೈಡ್ರಾಲಿಕ್ ಲೈನ್‌ಗಳನ್ನು ತಪಾಸಿಸಿ',
            'ತುರ್ತು ನಿಲುಗಡೆ ಕಾರ್ಯವನ್ನು ಪರಿಶೀಲಿಸಿ',
            'ಧೂಳು ನಿಗ್ರಹಕ್ಕಾಗಿ ನೀರಿನ ಸರಬರಾಜನ್ನು ಪರಿಶೀಲಿಸಿ',
            'ವೈಯಕ್ತಿಕ ರಕ್ಷಣಾ ಸಾಧನಗಳನ್ನು ತಪಾಸಿಸಿ'
        ],
        blaster: [
            'ಸ್ಫೋಟಕ ಸಂಗ್ರಹಣೆ ಭದ್ರತೆಯನ್ನು ಪರಿಶೀಲಿಸಿ',
            'ಡಿಟೋನೇಟರ್ ಕಾರ್ಯಚಟುವಟಿಕೆಯನ್ನು ಪರಿಶೀಲಿಸಿ',
            'ಸ್ಫೋಟ ಪ್ರದೇಶ ಕ್ಲಿಯರೆನ್ಸ್ ಅನ್ನು ತಪಾಸಿಸಿ',
            'ಸಂವಹನ ಸಾಧನಗಳನ್ನು ದೃಢೀಕರಿಸಿ',
            'ಸ್ಫೋಟ ಯೋಜನೆ ಮತ್ತು ಸಮಯವನ್ನು ಪರಿಶೀಲಿಸಿ'
        ],
        general: [
            'ಹೆಲ್ಮೆಟ್ ಮತ್ತು ಸುರಕ್ಷತಾ ಬೂಟುಗಳನ್ನು ತಪಾಸಿಸಿ',
            'ಕೆಲಸದ ಪ್ರದೇಶದಲ್ಲಿ ಅಪಾಯಗಳನ್ನು ಪರಿಶೀಲಿಸಿ',
            'ತುರ್ತು ನಿರ್ಗಮನ ಮಾರ್ಗಗಳನ್ನು ಪರಿಶೀಲಿಸಿ',
            'ಉಪಕರಣಗಳು ಮತ್ತು ಸಾಧನಗಳನ್ನು ತಪಾಸಿಸಿ',
            'ದೈನಂದಿನ ಸುರಕ್ಷತಾ ಬ್ರೀಫಿಂಗ್ ಅನ್ನು ಪರಿಶೀಲಿಸಿ'
        ]
    },
    ta: {
        drill: [
            'துரப்பண பிட் நிலையை சரிபார்க்கவும்',
            'ஹைட்ராலிக் வரிகளை ஆய்வு செய்யவும்',
            'அவசர நிறுத்த செயல்பாட்டை சரிபார்க்கவும்',
            'தூசி அடக்குதலுக்கான நீர் விநியோகத்தை சரிபார்க்கவும்',
            'தனிப்பட்ட பாதுகாப்பு உபகரணங்களை ஆய்வு செய்யவும்'
        ],
        blaster: [
            'வெடிபொருள் சேமிப்பு பாதுகாப்பை சரிபார்க்கவும்',
            'வெடிகுண்டு செயல்பாட்டை சரிபார்க்கவும்',
            'வெடிப்பு பகுதி அனுமதியை ஆய்வு செய்யவும்',
            'தொடர்பு சாதனங்களை உறுதிப்படுத்தவும்',
            'வெடிப்பு திட்டம் மற்றும் நேரத்தை மதிப்பாய்வு செய்யவும்'
        ],
        general: [
            'தலைக்கவசம் மற்றும் பாதுகாப்பு பூட்ஸை ஆய்வு செய்யவும்',
            'பணி பகுதியில் ஆபத்துகளை சரிபார்க்கவும்',
            'அவசர வெளியேற்ற பாதைகளை சரிபார்க்கவும்',
            'கருவிகள் மற்றும் உபகரணங்களை ஆய்வு செய்யவும்',
            'தினசரி பாதுகாப்பு விளக்கத்தை மதிப்பாய்வு செய்யவும்'
        ]
    },
    ml: {
        drill: [
            'ഡ്രിൽ ബിറ്റ് അവസ്ഥ പരിശോധിക്കുക',
            'ഹൈഡ്രോളിക് ലൈനുകൾ പരിശോധിക്കുക',
            'അടിയന്തര സ്റ്റോപ്പ് പ്രവർത്തനം പരിശോധിക്കുക',
            'പൊടി അടിച്ചമർത്തലിനുള്ള ജലവിതരണം പരിശോധിക്കുക',
            'വ്യക്തിഗത സംരക്ഷണ ഉപകരണങ്ങൾ പരിശോധിക്കുക'
        ],
        blaster: [
            'സ്ഫോടക സംഭരണ സുരക്ഷ പരിശോധിക്കുക',
            'ഡിറ്റണേറ്റർ പ്രവർത്തനം പരിശോധിക്കുക',
            'സ്ഫോടന മേഖല ക്ലിയറൻസ് പരിശോധിക്കുക',
            'ആശയവിനിമയ ഉപകരണങ്ങൾ സ്ഥിരീകരിക്കുക',
            'സ്ഫോടന പദ്ധതിയും സമയവും അവലോകനം ചെയ്യുക'
        ],
        general: [
            'ഹെൽമെറ്റും സുരക്ഷാ ബൂട്ടുകളും പരിശോധിക്കുക',
            'ജോലി മേഖലയിൽ അപകടങ്ങൾ പരിശോധിക്കുക',
            'അടിയന്തര എക്സിറ്റ് റൂട്ടുകൾ പരിശോധിക്കുക',
            'ഉപകരണങ്ങളും സജ്ജീകരണങ്ങളും പരിശോധിക്കുക',
            'ദൈനംദിന സുരക്ഷാ ബ്രീഫിംഗ് അവലോകനം ചെയ്യുക'
        ]
    },
    mr: {
        drill: [
            'ड्रिल बिटची स्थिती तपासा',
            'हायड्रॉलिक लाइन्सची तपासणी करा',
            'आणीबाणीचे स्टॉप फंक्शन सत्यापित करा',
            'धूळ दडपण्यासाठी पाणी पुरवठा तपासा',
            'वैयक्तिक संरक्षण उपकरणांची तपासणी करा'
        ],
        blaster: [
            'स्फोटक साठवण सुरक्षा सत्यापित करा',
            'डिटोनेटर कार्यक्षमता तपासा',
            'स्फोट क्षेत्र मंजुरीची तपासणी करा',
            'संप्रेषण उपकरणांची पुष्टी करा',
            'स्फोट योजना आणि वेळेचे पुनरावलोकन करा'
        ],
        general: [
            'हेल्मेट आणि सुरक्षा बूट तपासा',
            'कार्य क्षेत्रात धोक्यांसाठी तपासा',
            'आणीबाणी बाहेर पडण्याचे मार्ग सत्यापित करा',
            'साधने आणि उपकरणे तपासा',
            'दैनंदिन सुरक्षा ब्रीफिंगचे पुनरावलोकन करा'
        ]
    },
    bn: {
        drill: [
            'ড্রিল বিট অবস্থা পরীক্ষা করুন',
            'হাইড্রোলিক লাইন পরিদর্শন করুন',
            'জরুরি স্টপ ফাংশন যাচাই করুন',
            'ধূলিকণা দমনের জন্য জল সরবরাহ পরীক্ষা করুন',
            'ব্যক্তিগত সুরক্ষা সরঞ্জাম পরিদর্শন করুন'
        ],
        blaster: [
            'বিস্ফোরক সংরক্ষণ নিরাপত্তা যাচাই করুন',
            'ডেটোনেটর কার্যকারিতা পরীক্ষা করুন',
            'বিস্ফোরণ এলাকা ছাড়পত্র পরিদর্শন করুন',
            'যোগাযোগ ডিভাইস নিশ্চিত করুন',
            'বিস্ফোরণ পরিকল্পনা এবং সময় পর্যালোচনা করুন'
        ],
        general: [
            'হেলমেট এবং নিরাপত্তা বুট পরিদর্শন করুন',
            'কাজের এলাকায় বিপদের জন্য পরীক্ষা করুন',
            'জরুরি প্রস্থান রুট যাচাই করুন',
            'সরঞ্জাম এবং যন্ত্রপাতি পরিদর্শন করুন',
            'দৈনিক নিরাপত্তা ব্রিফিং পর্যালোচনা করুন'
        ]
    },
    gu: {
        drill: [
            'ડ્રિલ બિટની સ્થિતિ તપાસો',
            'હાઇડ્રોલિક લાઇનનું નિરીક્ષણ કરો',
            'ઈમરજન્સી સ્ટોપ ફંક્શન ચકાસો',
            'ધૂળ દમન માટે પાણી પુરવઠો તપાસો',
            'વ્યક્તિગત સંરક્ષણ સાધનોનું નિરીક્ષણ કરો'
        ],
        blaster: [
            'વિસ્ફોટક સંગ્રહ સુરક્ષા ચકાસો',
            'ડિટોનેટર કાર્યક્ષમતા તપાસો',
            'વિસ્ફોટ વિસ્તાર ક્લિયરન્સનું નિરીક્ષણ કરો',
            'સંચાર ઉપકરણોની પુષ્ટિ કરો',
            'વિસ્ફોટ યોજના અને સમયની સમીક્ષા કરો'
        ],
        general: [
            'હેલ્મેટ અને સુરક્ષા બૂટનું નિરીક્ષણ કરો',
            'કાર્ય વિસ્તારમાં જોખમો તપાસો',
            'ઈમરજન્સી એક્ઝિટ માર્ગો ચકાસો',
            'સાધનો અને સાધનસામગ્રીનું નિરીક્ષણ કરો',
            'દૈનિક સુરક્ષા બ્રીફિંગની સમીક્ષા કરો'
        ]
    },
    or: {
        drill: [
            'ଡ୍ରିଲ ବିଟ୍ ସ୍ଥିତି ଯାଞ୍ଚ କରନ୍ତୁ',
            'ହାଇଡ୍ରୋଲିକ୍ ଲାଇନଗୁଡିକୁ ଯାଞ୍ଚ କରନ୍ତୁ',
            'ଜରୁରୀକାଳୀନ ସ୍ଥଗିତ କାର୍ଯ୍ୟ ଯାଞ୍ଚ କରନ୍ତୁ',
            'ଧୂଳି ଦମନ ପାଇଁ ଜଳ ଯୋଗାଣ ଯାଞ୍ଚ କରନ୍ତୁ',
            'ବ୍ୟକ୍ତିଗତ ସୁରକ୍ଷା ଉପକରଣ ଯାଞ୍ଚ କରନ୍ତୁ'
        ],
        blaster: [
            'ବିସ୍ଫୋରକ ଭଣ୍ଡାର ସୁରକ୍ଷା ଯାଞ୍ଚ କରନ୍ତୁ',
            'ଡିଟୋନେଟର କାର୍ଯ୍ୟକ୍ଷମତା ଯାଞ୍ଚ କରନ୍ତୁ',
            'ବିସ୍ଫୋରଣ କ୍ଷେତ୍ର କ୍ଲିୟରାନ୍ସ ଯାଞ୍ଚ କରନ୍ତୁ',
            'ଯୋଗାଯୋଗ ଉପକରଣ ନିଶ୍ଚିତ କରନ୍ତୁ',
            'ବିସ୍ଫୋରଣ ଯୋଜନା ଏବଂ ସମୟ ସମୀକ୍ଷା କରନ୍ତୁ'
        ],
        general: [
            'ହେଲମେଟ ଏବଂ ସୁରକ୍ଷା ବୁଟ୍ ଯାଞ୍ଚ କରନ୍ତୁ',
            'କାର୍ଯ୍ୟ କ୍ଷେତ୍ରରେ ବିପଦ ଯାଞ୍ଚ କରନ୍ତୁ',
            'ଜରୁରୀକାଳୀନ ବହିର୍ଗମନ ପଥ ଯାଞ୍ଚ କରନ୍ତୁ',
            'ଉପକରଣ ଏବଂ ସାଧନ ଯାଞ୍ଚ କରନ୍ତୁ',
            'ଦୈନନ୍ଦିନ ସୁରକ୍ଷା ବ୍ରିଫିଂ ସମୀକ୍ଷା କରନ୍ତୁ'
        ]
    }
};
        // Update checklist based on language and role
        function updateChecklist() {
            const checklistUl = document.getElementById('checklistItems');
            checklistUl.innerHTML = '';
            
            const items = checklistData[currentLanguage][currentRole];
            items.forEach((item, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <input type="checkbox" id="check${index}" />
                    <label for="check${index}">${item}</label>
                `;
                checklistUl.appendChild(li);
            });
        }

        function updateChecklistLanguage() {
            currentLanguage = document.getElementById('language').value;
            updateChecklist();
        }

        function updateChecklistRole() {
            currentRole = document.getElementById('roleType').value;
            updateChecklist();
        }

        // Initialize checklist
        updateChecklist();

        // Text-to-speech function
        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = currentLanguage === 'en' ? 'en-US' : currentLanguage === 'hi' ? 'hi-IN' : 'te-IN';
                speechSynthesis.speak(utterance);
            } else {
                alert('Text-to-speech not supported in this browser');
            }
        }

        function readChecklist() {
            const items = checklistData[currentLanguage][currentRole];
            const text = items.join('. ');
            speak(text);
        }

       function readHazardInstructions() {
    const instructions = {
        en: 'Please describe the hazard in detail and attach a photo or video if possible. Submit your report to help keep everyone safe.',
        hi: 'कृपया खतरे का विस्तार से वर्णन करें और यदि संभव हो तो एक फोटो या वीडियो संलग्न करें। सभी को सुरक्षित रखने में मदद के लिए अपनी रिपोर्ट जमा करें।',
        te: 'దయచేసి ప్రమాదాన్ని వివరంగా వివరించండి మరియు సాధ్యమైతే ఫోటో లేదా వీడియోను జోడించండి. అందరినీ సురక్షితంగా ఉంచడానికి మీ నివేదికను సమర్పించండి.',
        kn: 'ದಯವಿಟ್ಟು ಅಪಾಯವನ್ನು ವಿವರವಾಗಿ ವಿವರಿಸಿ ಮತ್ತು ಸಾಧ್ಯವಾದರೆ ಫೋಟೋ ಅಥವಾ ವೀಡಿಯೊವನ್ನು ಲಗತ್ತಿಸಿ. ಎಲ್ಲರನ್ನು ಸುರಕ್ಷಿತವಾಗಿರಿಸಲು ನಿಮ್ಮ ವರದಿಯನ್ನು ಸಲ್ಲಿಸಿ.',
        ta: 'தயவுசெய்து ஆபத்தை விரிவாக விவரிக்கவும் மற்றும் முடிந்தால் புகைப்படம் அல்லது வீடியோவை இணைக்கவும். அனைவரையும் பாதுகாப்பாக வைத்திருக்க உங்கள் அறிக்கையை சமர்ப்பிக்கவும்.',
        ml: 'ദയവായി അപകടത്തെ വിശദമായി വിവരിക്കുകയും സാധ്യമെങ്കിൽ ഫോട്ടോ അല്ലെങ്കിൽ വീഡിയോ അറ്റാച്ച് ചെയ്യുകയും ചെയ്യുക. എല്ലാവരെയും സുരക്ഷിതരാക്കാൻ നിങ്ങളുടെ റിപ്പോർട്ട് സമർപ്പിക്കുക.',
        mr: 'कृपया धोक्याचे तपशीलवार वर्णन करा आणि शक्य असल्यास फोटो किंवा व्हिडिओ जोडा. प्रत्येकाला सुरक्षित ठेवण्यासाठी तुमचा अहवाल सबमिट करा.',
        bn: 'অনুগ্রহ করে বিপদের বিস্তারিত বর্ণনা করুন এবং সম্ভব হলে একটি ফটো বা ভিডিও সংযুক্ত করুন। সবাইকে নিরাপদ রাখতে আপনার রিপোর্ট জমা দিন।',
        gu: 'કૃપા કરીને જોખમનું વિગતવાર વર્ણન કરો અને શક્ય હોય તો ફોટો અથવા વિડિયો જોડો. દરેકને સુરક્ષિત રાખવામાં મદદ કરવા માટે તમારો રિપોર્ટ સબમિટ કરો.',
        or: 'ଦୟାକରି ବିପଦକୁ ବିସ୍ତୃତ ଭାବରେ ବର୍ଣ୍ଣନା କରନ୍ତୁ ଏବଂ ସମ୍ଭବ ହେଲେ ଏକ ଫଟୋ କିମ୍ବା ଭିଡିଓ ସଂଲଗ୍ନ କରନ୍ତୁ। ସମସ୍ତଙ୍କୁ ସୁରକ୍ଷିତ ରଖିବାରେ ସାହାଯ୍ୟ କରିବାକୁ ଆପଣଙ୍କର ରିପୋର୍ଟ ଦାଖଲ କରନ୍ତୁ।',
        pa: 'ਕਿਰਪਾ ਕਰਕੇ ਖ਼ਤਰੇ ਦਾ ਵਿਸਥਾਰ ਨਾਲ ਵਰਣਨ ਕਰੋ ਅਤੇ ਜੇ ਸੰਭਵ ਹੋਵੇ ਤਾਂ ਇੱਕ ਫੋਟੋ ਜਾਂ ਵੀਡੀਓ ਨੱਥੀ ਕਰੋ। ਹਰ ਕਿਸੇ ਨੂੰ ਸੁਰੱਖਿਅਤ ਰੱਖਣ ਵਿੱਚ ਮਦਦ ਕਰਨ ਲਈ ਆਪਣੀ ਰਿਪੋਰਟ ਜਮ੍ਹਾਂ ਕਰੋ।',
        as: 'অনুগ্ৰহ কৰি বিপদৰ বিশদ বিৱৰণ দিয়ক আৰু সম্ভৱ হ\'লে এখন ফটো বা ভিডিঅ\' সংলগ্ন কৰক। সকলোকে সুৰক্ষিত ৰাখিবলৈ আপোনাৰ প্ৰতিবেদন দাখিল কৰক।',
        ur: 'براہ کرم خطرے کی تفصیل سے وضاحت کریں اور ممکن ہو تو تصویر یا ویڈیو منسلک کریں۔ سب کو محفوظ رکھنے میں مدد کے لیے اپنی رپورٹ جمع کرائیں۔'
    };
    
    const language = currentLanguage || 'en';
    speak(instructions[language]);
}

        function checkWorkerZone() {
            const zoneAlert = document.getElementById('zoneAlert');
            
            // Simulate geolocation check
            const isInSafeZone = Math.random() > 0.3;
            
            if (isInSafeZone) {
                zoneAlert.className = 'safe';
                zoneAlert.textContent = '✓ You are in a safe zone';
            } else {
                zoneAlert.className = 'danger';
                zoneAlert.textContent = '⚠ Warning: You are in a restricted zone!';
            }
        }

        function submitChecklist() {
            const checkboxes = document.querySelectorAll('#checklistItems input[type="checkbox"]');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            
            if (allChecked) {
                const successMsg = document.getElementById('checklistSuccess');
                successMsg.classList.add('show');
                userPoints += 10;
                setTimeout(() => successMsg.classList.remove('show'), 3000);
            } else {
                alert('Please complete all checklist items before submitting');
            }
        }

        function markVideoWatched() {
            const successMsg = document.getElementById('videoSuccess');
            successMsg.classList.add('show');
            userPoints += 10;
            setTimeout(() => successMsg.classList.remove('show'), 3000);
        }

        function submitHazard() {
            const hazardDesc = document.getElementById('hazardDesc').value;
            const hazardFile = document.getElementById('hazardFile').files[0];
            
            if (hazardDesc.trim()) {
                const successMsg = document.getElementById('hazardSuccess');
                successMsg.classList.add('show');
                userPoints += 15;
                
                // Clear form
                document.getElementById('hazardDesc').value = '';
                document.getElementById('hazardFile').value = '';
                
                setTimeout(() => successMsg.classList.remove('show'), 3000);
            } else {
                alert('Please describe the hazard before submitting');
            }
        }

        function logout() {
            window.location.href = 'index.html';
        }

        // ================== LIVE GEOFENCE + MAP (WORKER) — added ================== //
        const hazardZones = [
          { name: "Blasting Zone",   lat: 19.125, lon: 84.125, radius: 120, baseRisk: "HIGH" },
          { name: "Heavy Machinery", lat: 19.123, lon: 84.123, radius: 140, baseRisk: "MEDIUM" },
          { name: "Storage Yard",    lat: 19.127, lon: 84.128, radius: 100,  baseRisk: "LOW" }
        ];

        let workerMap, workerMarker, zoneCircles = [];
        let watchId = null;

        function zoneRiskWithHazards(zone) {
          // Hook to real hazard data later
          return zone.baseRisk;
        }
        function riskColor(level) {
          return level === "HIGH" ? "#d90429" : level === "MEDIUM" ? "#ffb703" : "#2a9d8f";
        }
        function distMeters(lat1, lon1, lat2, lon2) {
          const R = 6371000, dLat=(lat2-lat1)*Math.PI/180, dLon=(lon2-lon1)*Math.PI/180;
          const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
          return 2*R*Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }
        function initWorkerMap() {
          if (workerMap) return;
          const container = document.getElementById('zoneMap');
          if (!container) return;

          workerMap = L.map('zoneMap').setView([hazardZones[0].lat, hazardZones[0].lon], 16);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19, attribution: '&copy; OpenStreetMap'
          }).addTo(workerMap);

          paintZones();

          workerMarker = L.marker([hazardZones[0].lat, hazardZones[0].lon]).addTo(workerMap);
          workerMarker.bindTooltip("Your position");
        }
        function paintZones() {
          if (!workerMap) return;
          zoneCircles.forEach(c => workerMap.removeLayer(c));
          zoneCircles = [];

          hazardZones.forEach(z => {
            const level = zoneRiskWithHazards(z);
            const circle = L.circle([z.lat, z.lon], {
              radius: z.radius, color: riskColor(level), fillColor: riskColor(level),
              fillOpacity: 0.25, weight: 2
            }).addTo(workerMap);
            circle.bindTooltip(`${z.name} — Risk: ${level}`);
            zoneCircles.push(circle);
          });
        }
        function updateZoneAlert(text) {
          const el = document.getElementById("zoneAlert");
          if (el) {
            el.className = ""; // reset style
            el.style.display = "block";
            el.innerText = text;
            // colorize based on wording
            if (text.includes("risk") || text.includes("Warning") || text.includes("⚠️")) {
              el.classList.add("danger");
            } else {
              el.classList.add("safe");
            }
          }
          if (typeof speak === "function") { try { speak(text); } catch(e){} }
        }
        function handlePosition(lat, lon) {
          if (!workerMap) initWorkerMap();

          workerMarker.setLatLng([lat, lon]);
          workerMap.setView([lat, lon], workerMap.getZoom());

          const username = sessionStorage.getItem('username') || 'Worker';
          localStorage.setItem(`workerLocation_${username}`, JSON.stringify({ user: username, lat, lon, ts: Date.now() }));

          let message = "You are in a safe zone.";
          let breached = null;

          hazardZones.forEach(z => {
            const d = distMeters(lat, lon, z.lat, z.lon);
            if (d <= z.radius) {
              const risk = zoneRiskWithHazards(z);
              message = `⚠️ ${z.name} — ${risk} risk area`;
              if (risk !== "LOW") breached = { zone: z, risk, distance: Math.round(d) };
            }
          });

          updateZoneAlert(message);

          if (breached) {
            const lastKey = `lastBreach_${username}_${breached.zone.name}`;
            const lastTs = parseInt(localStorage.getItem(lastKey) || "0", 10);
            const now = Date.now();
            if (!lastTs || now - lastTs > 60_000) {
              const events = JSON.parse(localStorage.getItem("breachEvents") || "[]");
              events.push({ user: username, zone: breached.zone.name, risk: breached.risk, lat, lon, time: new Date().toLocaleString() });
              localStorage.setItem("breachEvents", JSON.stringify(events));
              localStorage.setItem(lastKey, String(now));
            }
          }
        }
        async function startLiveTracking() {
          initWorkerMap();
          if (!('geolocation' in navigator)) {
            updateZoneAlert("Geolocation not supported.");
            return;
          }

          // Trigger permission once (clean prompt)
          try {
            await new Promise((resolve, reject) => {
              navigator.geolocation.getCurrentPosition(resolve, reject, { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 });
            });
          } catch (_) {}

          if (watchId) navigator.geolocation.clearWatch(watchId);

          watchId = navigator.geolocation.watchPosition(
            pos => handlePosition(pos.coords.latitude, pos.coords.longitude),
            err => {
              console.error("watchPosition error", err);
              updateZoneAlert("Location error: " + (err.message || err.code));
            },
            { enableHighAccuracy: true, maximumAge: 2000, timeout: 15000 }
          );

          updateZoneAlert("Tracking started. Stay safe.");
        }
        function stopLiveTracking() {
          if (watchId) {
            navigator.geolocation.clearWatch(watchId);
            watchId = null;
          }
          updateZoneAlert("Tracking stopped.");
        }

        // expose to buttons
        window.startLiveTracking = startLiveTracking;
        window.stopLiveTracking  = stopLiveTracking;
        window.repaintZones      = paintZones;
        // ================== /LIVE GEOFENCE + MAP ================== //
    </script>
<script src="script.js"></script>

<!-- ✅ Firebase init (ONLY ONCE) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB-mO8SbZa4ajdDjBOFItnjpCbs1twqVgc",
    authDomain: "mine-safety-system.firebaseapp.com",
    projectId: "mine-safety-system",
    storageBucket: "mine-safety-system.firebasestorage.app",
    messagingSenderId: "542149010693",
    appId: "1:542149010693:web:8832d89cb04ab31f03436c",
    measurementId: "G-YX5YTQJWZ6"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const workerName = sessionStorage.getItem('username') || 'Worker';

  if ('geolocation' in navigator) {
    navigator.geolocation.watchPosition(async pos => {
      try {
        await setDoc(doc(db, "workerLocations", workerName), {
          lat: pos.coords.latitude,
          lon: pos.coords.longitude,
          updatedAt: serverTimestamp()
        });
        console.log("📡 Location updated to Firebase");
      } catch (e) {
        console.error("❌ Firebase location error:", e);
      }
    });
  }
</script>

<!-- ✅ Camera PPE Detection — NORMAL SCRIPT (not module) -->
<script>
let model;
let cameraStream;
let detectionInterval;

async function startCamera() {
  const video = document.getElementById('camera');
  const status = document.getElementById('cameraStatus');

  if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
    status.innerText = "Camera API not supported.";
    return;
  }

  try {
    cameraStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
    video.srcObject = cameraStream;
    await video.play();

    status.innerText = "Camera started, loading AI model...";
    if (!model) model = await cocoSsd.load();
    status.innerText = "Model loaded. Show your PPE items.";

    clearInterval(detectionInterval);
    detectionInterval = setInterval(() => detectPPE(video), 1000);

  } catch (err) {
    console.error(err);
    status.innerText = "Camera error: " + err.message;
  }
}

function stopCamera() {
  const status = document.getElementById('cameraStatus');
  clearInterval(detectionInterval);
  if (cameraStream) {
    cameraStream.getTracks().forEach(t => t.stop());
    cameraStream = null;
  }
  status.innerText = "Camera stopped.";
}

function detectPPE(video) {
  if (!model) return;
  model.detect(video).then(predictions => {
    const seen = predictions.map(p => p.class.toLowerCase());
    document.getElementById('cameraStatus').innerText =
      `Detecting: ${seen.slice(0,5).join(", ") || "none"}`;
  });
}

// ✅ Attach functions to window for button onclick
window.startCamera = startCamera;
window.stopCamera = stopCamera;


     function sendSOS() {
            const workerName = sessionStorage.getItem('username') || 'Worker';
            
            // Get location
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude.toFixed(6);
                        const lng = position.coords.longitude.toFixed(6);
                        
                        // Emergency data
                        const emergencyData = {
                            worker: workerName,
                            latitude: lat,
                            longitude: lng,
                            timestamp: new Date().toLocaleString(),
                            message: '🚨 EMERGENCY! Worker needs immediate assistance!'
                        };

                        // Log to console
                        console.log('Emergency Alert:', emergencyData);
                        
                        // Send to WhatsApp
                        sendWhatsApp(emergencyData);
                        
                        // Show success message
                        const alertMsg = document.getElementById('alertMsg');
                        alertMsg.textContent = '✅ Opening WhatsApp to send emergency alert...';
                        alertMsg.classList.add('show');
                        
                        setTimeout(() => {
                            alertMsg.classList.remove('show');
                        }, 5000);
                    },
                    function(error) {
                        console.error('Location error:', error);
                        
                        // Send without location
                        const emergencyData = {
                            worker: workerName,
                            latitude: 'Unknown',
                            longitude: 'Unknown',
                            timestamp: new Date().toLocaleString(),
                            message: '🚨 EMERGENCY! Worker needs immediate assistance!'
                        };
                        
                        sendWhatsApp(emergencyData);
                        alert('Location unavailable. Sending emergency alert without location data.');
                    }
                );
            } else {
                // Send without location
                const emergencyData = {
                    worker: workerName,
                    latitude: 'Not supported',
                    longitude: 'Not supported',
                    timestamp: new Date().toLocaleString(),
                    message: '🚨 EMERGENCY! Worker needs immediate assistance!'
                };
                
                sendWhatsApp(emergencyData);
                alert('Geolocation not supported. Sending emergency alert without location data.');
            }
        }

        // Send emergency message via WhatsApp
        function sendWhatsApp(data) {
            // Format emergency message
            const message = `🚨 *MINE SAFETY EMERGENCY ALERT* 🚨

⚠️ *Worker:* ${data.worker}
📍 *Location:* 
   Latitude: ${data.latitude}
   Longitude: ${data.longitude}
🕐 *Time:* ${data.timestamp}

${data.message}

*IMMEDIATE ASSISTANCE REQUIRED!*
Please respond immediately and dispatch help.

Google Maps: https://www.google.com/maps?q=${data.latitude},${data.longitude}`;

            // Replace with your supervisor's phone number (include country code without + or -)
            // Example: India +91 1234567890 becomes 911234567890
            const supervisorPhone = '911234567890'; // CHANGE THIS TO ACTUAL NUMBER
            
            // Create WhatsApp URL
            const whatsappUrl = `https://wa.me/${supervisorPhone}?text=${encodeURIComponent(message)}`;
            
            // Open WhatsApp in new tab
            window.open(whatsappUrl, '_blank');
        }
</script>



</body>

</html>





























